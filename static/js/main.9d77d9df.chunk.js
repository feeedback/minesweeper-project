(this.webpackJsonpminesweeper=this.webpackJsonpminesweeper||[]).push([[0],[,,,function(e,t,s){e.exports=s(12)},,,,,function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t);var a=s(0),i=s.n(a),n=s(2),l=s.n(n);s(8),s(9),s(10);class o extends i.a.PureComponent{constructor(e){super(e),this.handleChange=({target:{name:e,value:t}})=>{this.setState({[e]:t})},this.handleSubmitStartNewGame=e=>{e.preventDefault();const{columnsCount:t,rowsCount:s,minesCount:a}=this.state,{handleStartNewGame:i}=this.props;i(Number(t),Number(s),Number(a))},this.state={columnsCount:9,rowsCount:9,minesCount:10}}componentDidMount(){const{columnsCount:e,rowsCount:t,minesCount:s}=this.state,{handleStartNewGame:a}=this.props;a(Number(e),Number(t),Number(s))}render(){const{columnsCount:e,rowsCount:t,minesCount:s}=this.state,a=e*t-1;return i.a.createElement("form",{name:"initGameSettings",className:"formInitGameSettings",action:"",onSubmit:this.handleSubmitStartNewGame},i.a.createElement("label",{htmlFor:"x"},"X:",i.a.createElement("input",{type:"number",name:"columnsCount",className:"fieldColumnsCount",min:"2",max:"70",value:e,onChange:this.handleChange,required:!0})),i.a.createElement("label",{htmlFor:"y"},"Y:",i.a.createElement("input",{type:"number",name:"rowsCount",className:"fieldRowsCount",min:"2",max:"64",value:t,onChange:this.handleChange,required:!0})),i.a.createElement("label",{htmlFor:"mines"},"Mines:",i.a.createElement("input",{type:"number",name:"minesCount",className:"fieldMinesCount",min:"1",max:a,value:s,onChange:this.handleChange,required:!0})),i.a.createElement("button",{type:"submit",className:"buttonStartGame"},"Start game!"))}}var r=o;s(11);const h={0:"",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",M:"\ud83d\udca3",ME:"\ud83d\udca3",C:"",F:"\ud83d\udea9",FW:"\u2715"},c={0:"empty",1:"digit1",2:"digit2",3:"digit3",4:"digit4",5:"digit5",6:"digit6",7:"digit7",8:"digit8",M:"mine",ME:"mine mineExplosion",C:"closed",F:"closed flagged",FW:"flaggedWrong"},d={0:"empty",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",M:"mine",ME:"explosion mine",C:"closed",F:"flagged",FW:"wrong flagged"};var m=({closedField:e,fieldIsDisable:t,boardHandles:s})=>i.a.createElement("div",Object.assign({className:"fieldContainer"},s),e.map((e,s)=>e.map((e,a)=>i.a.createElement("button",{key:"Cell__".concat(a,"_").concat(s),"data-x":a,"data-y":s,className:"Cell ".concat(c[e]),disabled:t[s][a],"aria-label":d[e]},h[e]))));const u=e=>((e,t)=>Math.floor(e+Math.random()*(t+1-e)))(0,e-1),g={ZERO_MINES_NEARBY:0,ONE_MINES_NEARBY:1,TWO_MINES_NEARBY:2,THREE_MINES_NEARBY:3,FOUR_MINES_NEARBY:4,FIVE_MINES_NEARBY:5,SIX_MINES_NEARBY:6,SEVEN_MINES_NEARBY:7,EIGHT_MINES_NEARBY:8,CELL_CLOSED:"C",MINE:"M",MINE_EXPLOSION:"ME",FLAG:"F",FLAG_IN_WRONG_POSITION:"FW"};var E=class{constructor(e=9,t=9,s=10){if(s>e*t)throw new Error("ERROR: mines more than cell");this.x=e,this.y=t,this.mines=s,this.field=[],this.closedField=[],this.leftFlags=s,this.leftClosed=e*t,this.gameState="playing",this.mapDefinitionToSymbol=g}_initMines(){let e=this.mines;for(;0!==e;){const t=u(this.x),s=u(this.y);this.field[s][t]!==g.MINE&&(this.field[s][t]=g.MINE,e-=1)}}_getArea8(e,t){const s=[];for(let a=t-1;a<=t+1;a+=1)for(let i=e-1;i<=e+1;i+=1)a>=0&&a<this.y&&i>=0&&i<this.x&&(e!==i||t!==a)&&s.push({x:i,y:a});return s}_getArea8Closed(e,t,s=this._getArea8(e,t)){return s.filter(({x:e,y:t})=>this.closedField[t][e]===g.CELL_CLOSED)}_getArea8Flagged(e,t,s=this._getArea8(e,t)){return s.filter(({x:e,y:t})=>this.closedField[t][e]===g.FLAG)}_increaseMineCounterInArea8(e,t){this._getArea8(e,t).forEach(({x:e,y:t})=>{const s=this.field[t][e];s!==g.MINE&&(this.field[t][e]=s+1)})}_calculateMinesAndSetCounterValues(){this.field.forEach((e,t)=>e.forEach((e,s)=>{e===g.MINE&&this._increaseMineCounterInArea8(s,t)}))}_initFieldAndFillValue(e){return Array.from({length:this.y},()=>new Array(this.x).fill(e))}init(){this.closedField=this._initFieldAndFillValue(g.CELL_CLOSED),this.field=this._initFieldAndFillValue(g.ZERO_MINES_NEARBY),this._initMines(),this._calculateMinesAndSetCounterValues(),this.gameState="playing"}_markAllWrongFlag(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.FLAG&&this.field[t][s]!==g.MINE&&(this.closedField[t][s]=g.FLAG_IN_WRONG_POSITION)}))}_markAllTailClosedFlag(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.CELL_CLOSED&&this.field[t][s]===g.MINE&&(this.closedField[t][s]=g.FLAG)}))}_showAllClosedMine(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.CELL_CLOSED&&this.field[t][s]===g.MINE&&(this.closedField[t][s]=g.MINE)}))}_exitLoseExplosion(e,t){this.closedField[t][e]=g.MINE_EXPLOSION,this._markAllWrongFlag(),this._showAllClosedMine(),this.gameState="lose"}_exitWinAllOpened(){this._markAllTailClosedFlag(),this.gameState="win"}_openCell(e,t){this.leftClosed-=1,this.closedField[t][e]=this.field[t][e]}stepToOpenCell(e,t){if(this.closedField[t][e]===g.CELL_CLOSED){if(this._openCell(e,t),this.field[t][e]===g.MINE)return this._exitLoseExplosion(e,t);if(this.leftClosed===this.leftFlags)return this._exitWinAllOpened();if(this.field[t][e]===g.ZERO_MINES_NEARBY){const s=this._getArea8Closed(e,t);for(const{x:e,y:t}of s)this.stepToOpenCell(e,t)}}}_setFlag(e,t){this.leftFlags-=1,this.leftClosed-=1,this.closedField[t][e]=g.FLAG}_removeFlag(e,t){this.leftFlags+=1,this.leftClosed+=1,this.closedField[t][e]=g.CELL_CLOSED}setOrRemoveFlag(e,t){this.closedField[t][e]===g.CELL_CLOSED&&this.leftFlags>0?this._setFlag(e,t):this.closedField[t][e]===g.FLAG&&this._removeFlag(e,t)}ifSafeSpaceOpenArea8(e,t){const s=this.closedField[t][e];if(!Number.isInteger(s)||s===g.ZERO_MINES_NEARBY)return;const a=this._getArea8(e,t),i=this._getArea8Flagged(e,t,a),n=this._getArea8Closed(e,t,a);if(s===i.length)for(const{x:l,y:o}of n)this.stepToOpenCell(l,o)}getNearestNotZeroCell(e,t){if(this.closedField[t][e]!==g.ZERO_MINES_NEARBY)return null;const s=[],a=(s,a)=>Math.sqrt((s-e)**2+(a-t)**2);if(this.closedField.forEach((e,t)=>e.forEach((e,i)=>{e!==g.ZERO_MINES_NEARBY&&s.push({x:i,y:t,distance:a(i,t)})})),0===s.length)return null;const[i]=s.sort((e,t)=>e.distance-t.distance);return i}};class f extends i.a.Component{constructor(e){super(e),this._updateState=()=>{this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField})},this._handleStartNewGame=(e,t,s)=>{this.game=new E(e,t,s),this.game.init(),document.documentElement.style.setProperty("--x",e),document.documentElement.style.setProperty("--y",t),this._updateState()},this.handleClick=e=>{const{target:t}=e;if(!t.classList.contains("Cell"))return!1;if(e.ctrlKey)return this.handleContextMenu(e);if(e.shiftKey)return this.handleMouseDown(e);const{x:s,y:a}=t.dataset;this.game.stepToOpenCell(Number(s),Number(a)),this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField,activeCell:{x:s,y:a}})},this.handleContextMenu=e=>{e.preventDefault();const{target:t}=e;if(!t.classList.contains("Cell"))return!1;const{x:s,y:a}=t.dataset;this.game.setOrRemoveFlag(Number(s),Number(a)),this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField,activeCell:{x:s,y:a}})},this.handleMouseDown=({target:e,button:t})=>{if(!e.classList.contains("Cell")||0!==t)return;const{x:s,y:a}=e.dataset;this.game.ifSafeSpaceOpenArea8(Number(s),Number(a)),this._updateState()},this.handleKeyDownArrow=({target:e,key:t})=>{const s={ArrowUp:(e,t)=>[e,t-1],ArrowDown:(e,t)=>[e,t+1],ArrowLeft:(e,t)=>[e-1,t],ArrowRight:(e,t)=>[e+1,t]};if(!Object.keys(s).includes(t))return;const{x:a,y:i}=e.dataset,{x:n,y:l}=this.game,{closedField:o}=this.state,r=(a,i)=>{const[h,c]=s[t](a,i);if(h<0||h>=n||c<0||c>=l)return;if(o[c][h]===this.game.mapDefinitionToSymbol.ZERO_MINES_NEARBY)return r(h,c);e.parentElement.children[h+c*n].focus()};r(Number(a),Number(i))},this.state={gameProcessState:"no-game",closedField:[],activeCell:{x:0,y:0}},this.boardEl=i.a.createRef()}componentDidUpdate(){const{activeCell:{x:e,y:t}}=this.state,s=this.game.getNearestNotZeroCell(e,t);null!==s?document.querySelector(".fieldContainer").children[s.x+s.y*this.game.x].focus():this.game.leftClosed===this.game.x*this.game.y&&document.querySelector(".fieldContainer").children[0].focus()}renderGameStatusMessage(){const e={win:i.a.createElement("span",{className:"messageWin"},"All opened right! You win!\ud83c\udfc6"),lose:i.a.createElement("span",{className:"messageLose"},"BOOM! Game Over! \u2620\ufe0f"),playing:null},{gameProcessState:t}=this.state,s=0===this.game.leftFlags?"messageFlags messageFlagsZero":"messageFlags";return i.a.createElement("div",{className:"message"},i.a.createElement("span",{className:s},"Flags: ",this.game.leftFlags," "),"of ",this.game.mines,". ",e[t])}render(){const{gameProcessState:e,closedField:t}=this.state,s={onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseDown:this.handleMouseDown,onKeyDown:this.handleKeyDownArrow},a=t.map(t=>t.map(t=>"playing"!==e||t===this.game.mapDefinitionToSymbol.ZERO_MINES_NEARBY));return i.a.createElement("div",{className:"App",onContextMenu:e=>e.preventDefault()},i.a.createElement(r,{handleStartNewGame:this._handleStartNewGame}),"no-game"===e?null:i.a.createElement(i.a.Fragment,null,this.renderGameStatusMessage(),i.a.createElement(m,{closedField:t,fieldIsDisable:a,boardHandles:s})))}}var C=f;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[3,1,2]]]);
//# sourceMappingURL=main.9d77d9df.chunk.js.map