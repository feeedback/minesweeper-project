(this.webpackJsonpMinesweeper=this.webpackJsonpMinesweeper||[]).push([[0],[,,,function(e,t,s){e.exports=s(12)},,,,,function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t);var n=s(0),i=s.n(n),a=s(2),l=s.n(a);s(8),s(9),s(10);class o extends i.a.PureComponent{constructor(e){super(e),this.handleChange=({target:{name:e,value:t}})=>{this.setState({[e]:t})},this.handleSubmitStartNewGame=e=>{e.preventDefault();const{columnsCount:t,rowsCount:s,minesCount:n}=this.state,{handleStartNewGame:i}=this.props;i(Number(t),Number(s),Number(n))},this.state={columnsCount:9,rowsCount:9,minesCount:10}}componentDidMount(){const{columnsCount:e,rowsCount:t,minesCount:s}=this.state,{handleStartNewGame:n}=this.props;n(Number(e),Number(t),Number(s))}render(){const{columnsCount:e,rowsCount:t,minesCount:s}=this.state,n=e*t-1;return i.a.createElement("form",{name:"initGameSettings",className:"formInitGameSettings",action:"",onSubmit:this.handleSubmitStartNewGame},i.a.createElement("label",{htmlFor:"x"},"X:",i.a.createElement("input",{type:"number",name:"columnsCount",className:"fieldColumnsCount",min:"2",max:"70",value:e,onChange:this.handleChange,required:!0})),i.a.createElement("label",{htmlFor:"y"},"Y:",i.a.createElement("input",{type:"number",name:"rowsCount",className:"fieldRowsCount",min:"2",max:"64",value:t,onChange:this.handleChange,required:!0})),i.a.createElement("label",{htmlFor:"mines"},"Mines:",i.a.createElement("input",{type:"number",name:"minesCount",className:"fieldMinesCount",min:"1",max:n,value:s,onChange:this.handleChange,required:!0})),i.a.createElement("button",{type:"submit",className:"buttonStartGame"},"Start game!"))}}var r=o;s(11);const c={0:"",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",M:"\ud83d\udca3",ME:"\ud83d\udca3",C:"",F:"\ud83d\udea9",FW:"\u2715"},h={0:"empty",1:"digit1",2:"digit2",3:"digit3",4:"digit4",5:"digit5",6:"digit6",7:"digit7",8:"digit8",M:"mine",ME:"mine mineExplosion",C:"closed",F:"closed flagged",FW:"flaggedWrong"},d={0:"empty",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",M:"mine",ME:"explosion mine",C:"closed",F:"flagged",FW:"wrong flagged"};var m=({closedField:e,fieldIsDisable:t,boardHandles:s})=>i.a.createElement("div",Object.assign({className:"fieldContainer"},s),e.map((e,s)=>e.map((e,n)=>i.a.createElement("button",{key:"Cell__".concat(n,"_").concat(s),"data-x":n,"data-y":s,className:"Cell ".concat(h[e]),disabled:t[s][n],"aria-label":d[e]},c[e]))));const u=e=>((e,t)=>Math.floor(e+Math.random()*(t+1-e)))(0,e-1),g={ZERO_MINES_NEARBY:0,ONE_MINES_NEARBY:1,TWO_MINES_NEARBY:2,THREE_MINES_NEARBY:3,FOUR_MINES_NEARBY:4,FIVE_MINES_NEARBY:5,SIX_MINES_NEARBY:6,SEVEN_MINES_NEARBY:7,EIGHT_MINES_NEARBY:8,CELL_CLOSED:"C",MINE:"M",MINE_EXPLOSION:"ME",FLAG:"F",FLAG_IN_WRONG_POSITION:"FW"};var f=class{constructor(e=9,t=9,s=10){if(s>e*t)throw new Error("ERROR: mines more than cell");this.x=e,this.y=t,this.mines=s,this.field=[],this.closedField=[],this.leftFlags=s,this.leftClosed=e*t,this.gameState="playing",this.mapDefinitionToSymbol=g}_initMines(){let e=this.mines;for(;0!==e;){const t=u(this.x),s=u(this.y);this.field[s][t]!==g.MINE&&(this.field[s][t]=g.MINE,e-=1)}}_getArea8(e,t){const s=[];for(let n=t-1;n<=t+1;n+=1)for(let i=e-1;i<=e+1;i+=1)n>=0&&n<this.y&&i>=0&&i<this.x&&(e!==i||t!==n)&&s.push({x:i,y:n});return s}_getArea8Closed(e,t,s=this._getArea8(e,t)){return s.filter(({x:e,y:t})=>this.closedField[t][e]===g.CELL_CLOSED)}_getArea8Flagged(e,t,s=this._getArea8(e,t)){return s.filter(({x:e,y:t})=>this.closedField[t][e]===g.FLAG)}_increaseMineCounterInArea8(e,t){this._getArea8(e,t).forEach(({x:e,y:t})=>{const s=this.field[t][e];s!==g.MINE&&(this.field[t][e]=s+1)})}_calculateMinesAndSetCounterValues(){this.field.forEach((e,t)=>e.forEach((e,s)=>{e===g.MINE&&this._increaseMineCounterInArea8(s,t)}))}_initFieldAndFillValue(e){return Array.from({length:this.y},()=>new Array(this.x).fill(e))}init(){this.closedField=this._initFieldAndFillValue(g.CELL_CLOSED),this.field=this._initFieldAndFillValue(g.ZERO_MINES_NEARBY),this._initMines(),this._calculateMinesAndSetCounterValues(),this.gameState="playing"}_markAllWrongFlag(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.FLAG&&this.field[t][s]!==g.MINE&&(this.closedField[t][s]=g.FLAG_IN_WRONG_POSITION)}))}_markAllTailClosedFlag(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.CELL_CLOSED&&this.field[t][s]===g.MINE&&(this.closedField[t][s]=g.FLAG)}))}_showAllClosedMine(){this.closedField.forEach((e,t)=>e.forEach((e,s)=>{e===g.CELL_CLOSED&&this.field[t][s]===g.MINE&&(this.closedField[t][s]=g.MINE)}))}_exitLoseExplosion(e,t){this.closedField[t][e]=g.MINE_EXPLOSION,this._markAllWrongFlag(),this._showAllClosedMine(),this.gameState="lose"}_exitWinAllOpened(){this._markAllTailClosedFlag(),this.gameState="win"}_openCell(e,t){this.leftClosed-=1,this.closedField[t][e]=this.field[t][e]}stepToOpenCell(e,t){if(this.closedField[t][e]===g.CELL_CLOSED){if(this._openCell(e,t),this.field[t][e]===g.MINE)return this._exitLoseExplosion(e,t);if(this.leftClosed===this.leftFlags)return this._exitWinAllOpened();if(this.field[t][e]===g.ZERO_MINES_NEARBY){const s=this._getArea8Closed(e,t);for(const{x:e,y:t}of s)this.stepToOpenCell(e,t)}}}_setFlag(e,t){this.leftFlags-=1,this.leftClosed-=1,this.closedField[t][e]=g.FLAG}_removeFlag(e,t){this.leftFlags+=1,this.leftClosed+=1,this.closedField[t][e]=g.CELL_CLOSED}setOrRemoveFlag(e,t){this.closedField[t][e]===g.CELL_CLOSED&&this.leftFlags>0?this._setFlag(e,t):this.closedField[t][e]===g.FLAG&&this._removeFlag(e,t)}ifSafeSpaceOpenArea8(e,t){const s=this.closedField[t][e];if(!Number.isInteger(s)||s===g.ZERO_MINES_NEARBY)return;const n=this._getArea8(e,t),i=this._getArea8Flagged(e,t,n),a=this._getArea8Closed(e,t,n);if(s===i.length)for(const{x:l,y:o}of a)this.stepToOpenCell(l,o)}getNearestNotZeroCell(e,t){if(this.closedField[t][e]!==g.ZERO_MINES_NEARBY)return null;const s=[],n=(s,n)=>Math.sqrt((s-e)**2+(n-t)**2);if(this.closedField.forEach((e,t)=>e.forEach((e,i)=>{e!==g.ZERO_MINES_NEARBY&&s.push({x:i,y:t,distance:n(i,t)})})),0===s.length)return null;const[i]=s.sort((e,t)=>e.distance-t.distance);return i}};class E extends i.a.Component{constructor(e){super(e),this._updateState=()=>{this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField})},this._handleStartNewGame=(e,t,s)=>{this.game=new f(e,t,s),this.game.init(),document.documentElement.style.setProperty("--x",e),document.documentElement.style.setProperty("--y",t),this._updateState()},this.handleClick=e=>{const{target:t}=e;if(!t.classList.contains("Cell"))return!1;if(e.ctrlKey)return this.handleContextMenu(e);if(e.shiftKey)return this.handleMouseDown(e);const{x:s,y:n}=t.dataset;this.game.stepToOpenCell(Number(s),Number(n)),this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField,activeCell:{x:s,y:n}})},this.handleContextMenu=e=>{e.preventDefault();const{target:t}=e;if(!t.classList.contains("Cell"))return!1;const{x:s,y:n}=t.dataset;this.game.setOrRemoveFlag(Number(s),Number(n)),this.setState({gameProcessState:this.game.gameState,closedField:this.game.closedField,activeCell:{x:s,y:n}})},this.handleMouseDown=({target:e,button:t})=>{if(!e.classList.contains("Cell")||0!==t)return;const{x:s,y:n}=e.dataset;this.game.ifSafeSpaceOpenArea8(Number(s),Number(n)),this._updateState()},this.handleKeyDownArrow=({target:e,key:t})=>{const s={ArrowUp:(e,t)=>[e,t-1],ArrowDown:(e,t)=>[e,t+1],ArrowLeft:(e,t)=>[e-1,t],ArrowRight:(e,t)=>[e+1,t]};if(!Object.keys(s).includes(t))return;const{x:n,y:i}=e.dataset,{x:a,y:l}=this.game,{closedField:o}=this.state,r=(n,i)=>{const[c,h]=s[t](n,i);if(c<0||c>=a||h<0||h>=l)return;if(o[h][c]===this.game.mapDefinitionToSymbol.ZERO_MINES_NEARBY)return r(c,h);e.parentElement.children[c+h*a].focus()};r(Number(n),Number(i))},this.state={gameProcessState:"no-game",closedField:[],activeCell:{x:0,y:0}},this.boardEl=i.a.createRef()}componentDidUpdate(){const{activeCell:{x:e,y:t}}=this.state,s=this.game.getNearestNotZeroCell(e,t);null!==s?document.querySelector(".fieldContainer").children[s.x+s.y*this.game.x].focus():this.game.leftClosed===this.game.x*this.game.y&&document.querySelector(".fieldContainer").children[0].focus()}renderGameStatusMessage(){const e={win:i.a.createElement("span",{className:"messageWin"},"All opened right! You win!\ud83c\udfc6"),lose:i.a.createElement("span",{className:"messageLose"},"BOOM! Game Over! \u2620\ufe0f"),playing:null},{gameProcessState:t}=this.state,s=0===this.game.leftFlags?"messageFlags messageFlagsZero":"messageFlags";return i.a.createElement("div",{className:"message"},i.a.createElement("span",{className:s},"Flags: ",this.game.leftFlags," "),"of ",this.game.mines,". ",e[t])}render(){const{gameProcessState:e,closedField:t}=this.state,s={onClick:this.handleClick,onContextMenu:this.handleContextMenu,onMouseDown:this.handleMouseDown,onKeyDown:this.handleKeyDownArrow},n=t.map(t=>t.map(t=>"playing"!==e||t===this.game.mapDefinitionToSymbol.ZERO_MINES_NEARBY));return i.a.createElement("div",{className:"App",onContextMenu:e=>e.preventDefault()},i.a.createElement(r,{handleStartNewGame:this._handleStartNewGame}),"no-game"===e?null:i.a.createElement(i.a.Fragment,null,this.renderGameStatusMessage(),i.a.createElement(m,{closedField:t,fieldIsDisable:n,boardHandles:s})))}}var C=E,N=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function _(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var s=e.installing;null!=s&&(s.onstatechange=function(){"installed"===s.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(C,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");N?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(s){var n=s.headers.get("content-type");404===s.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):_(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):_(t,e)}))}}()}],[[3,1,2]]]);
//# sourceMappingURL=main.9219136d.chunk.js.map